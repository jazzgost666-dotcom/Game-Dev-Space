<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Game Dev Space V2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    /* Vari√°veis CSS para um tema mais limpo */
    :root {
      --color-primary: #4f46e5; /* √çndigo Forte */
      --color-secondary: #22c55e; /* Verde Esmeralda */
      --color-danger: #ef4444; /* Vermelho */
      --bg-dark: #050510;
      --bg-card: #0f1025;
      --text-light: #fff;
      --border-radius: 18px;
    }

    *{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
    body{
      margin:0;
      color:var(--text-light);
      background:radial-gradient(circle at top, #1b1f3b, var(--bg-dark) 70%);
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:linear-gradient(120deg,rgba(79,70,229,.15),rgba(34,197,94,.1),rgba(236,72,153,.12));
      animation:bgMove 12s ease-in-out infinite alternate;
      z-index:-1;
    }
    @keyframes bgMove{from{filter:hue-rotate(0deg)}to{filter:hue-rotate(40deg)}}

    header{
      padding:20px 30px;
      text-align:center;
      position:sticky;
      top:0;
      backdrop-filter:blur(12px);
      background:rgba(10,10,25,.85);
      z-index:5;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }
    header h1{
      margin:0;
      font-size:32px;
      letter-spacing:1.5px;
      font-weight:800;
      color:var(--color-secondary); /* Destaque no t√≠tulo */
      text-shadow: 0 0 5px rgba(34,197,94,.5);
    }
    header .actions{
      position:absolute;
      right:30px;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      gap:10px;
    }

    button{
      background:var(--color-primary);
      color:var(--text-light);
      border:none;
      padding:12px 20px;
      border-radius:14px;
      font-weight:bold;
      cursor:pointer;
      transition:.3s ease;
      font-size:16px;
      box-shadow:0 3px 10px rgba(0,0,0,.3);
    }
    button:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 15px rgba(79,70,229,.5);
    }
    button#adminDelBtn{
      background:var(--color-danger);
    }
    button#adminDelBtn:hover{
      box-shadow:0 6px 15px rgba(239, 68, 68, .5);
    }
    button.back-btn{
      background: transparent;
      box-shadow: none;
      font-size: 18px;
      padding: 8px 15px;
      margin-bottom: 20px;
    }
    button.back-btn:hover{
      transform: scale(1.05);
      background: rgba(255, 255, 255, 0.1);
    }

    main{max-width:1200px;margin:auto;padding:30px}
    h2{
      margin:40px 0 16px;
      font-size:26px;
      border-left: 4px solid var(--color-secondary);
      padding-left: 10px;
    }

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:25px}

    .card{
      background:var(--bg-card);
      border-radius:var(--border-radius);
      overflow:hidden;
      cursor:pointer;
      transition:.3s ease;
      box-shadow:0 10px 40px rgba(0,0,0,.5);
      position:relative;
      border: 1px solid rgba(79, 70, 229, 0.2);
    }
    .card:hover{
      transform:translateY(-8px) scale(1.03);
      box-shadow:0 15px 50px rgba(79,70,229,.4);
    }
    .card img{width:100%;height:160px;object-fit:cover}

    .info{padding:16px}
    .info h3{margin:0 0 4px;font-size:18px;color:var(--color-secondary)}
    .info small{opacity:.7;display:block;height:40px;overflow:hidden;font-size:14px}

    .like-count{
      position:absolute;
      top:12px;
      left:12px;
      background:rgba(0,0,0,.7);
      border-radius:999px;
      padding:6px 12px;
      font-size:14px;
      display:flex;
      align-items:center;
      gap:5px;
      font-weight:600;
      color:var(--text-light);
    }

    .delete-btn{
      position:absolute;
      top:12px;
      right:12px;
      background:var(--color-danger);
      font-size:13px;
      padding:6px 10px;
      border-radius:10px;
      box-shadow:none;
      transition:.1s;
    }
    .delete-btn:hover{transform:none;box-shadow:0 0 10px var(--color-danger);}

    .game-page{
      max-width:900px;
      margin:auto;
      padding: 20px;
      background: var(--bg-card);
      border-radius: var(--border-radius);
      box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
    }
    .game-page img{width:100%;border-radius:var(--border-radius);height: 350px; object-fit: cover; margin-top: 10px;}
    .game-page h2{margin:20px 0 10px; padding-left: 0; border-left: none; font-size: 36px;}
    .game-page p{opacity:.9;font-size:17px;line-height: 1.6;}
    .game-actions{display:flex;gap:20px;margin-top:25px}

    footer{text-align:center;padding:30px;opacity:.5;font-size:14px}
  </style>
</head>
<body>

<audio id="bgMusic" src="https://cdn.pixabay.com/audio/2023/03/28/audio_9b27d4a8e2.mp3" autoplay loop></audio>

<header>
  <h1>Game Dev Space V2.0</h1>
  <div class="actions">
    <button id="loginBtn">Login</button>
    <button id="postBtn" style="display:none">Publicar Jogo</button>
    <button id="adminDelBtn" style="display:none">Apagar TODOS</button>
    <button id="logoutBtn" style="display:none">Sair</button>
  </div>
</header>

<main id="home">
  <h2>üî• Em Destaque</h2>
  <div class="grid" id="featured"></div>

  <h2>üïπÔ∏è Biblioteca Completa</h2>
  <div class="grid" id="games"></div>
</main>

<main id="gameView" style="display:none"></main>

<footer>Game Dev Space ‚Ä¢ Biblioteca de jogos HTML ‚Ä¢ Desenvolvido por um f√£ de c√≥digo aberto</footer>

<script>
/* ================= CONFIG ================= */
// Seu UID exclusivo para o Painel de Admin
const OWNER_UID = "EvTgWu6fFFeWJrFdckMNVa1E20J3"; 

const firebaseConfig = {
  apiKey: "AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
  authDomain: "game-dev-space.firebaseapp.com",
  databaseURL: "https://game-dev-space-default-rtdb.firebaseio.com",
  projectId: "game-dev-space",
  storageBucket: "game-dev-space.appspot.com",
  messagingSenderId: "1073185335190",
  appId: "1:1073185335190:web:ae9ffd88cdf89f53cbdfb7"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const gamesRef = db.ref("games");
// commentsRef foi removido
// const commentsRef = db.ref("comments"); 

let currentUser = null;

/* ================= AUTH & ADMIN PANEL ================= */
auth.onAuthStateChanged(user => {
  currentUser = user;
  const isAdmin = user && user.uid === OWNER_UID;

  // Controle de visibilidade dos bot√µes
  loginBtn.style.display  = user ? "none" : "inline-block";
  logoutBtn.style.display = user ? "inline-block" : "none";
  // Painel de Admin: S√≥ aparece para o OWNER_UID
  postBtn.style.display   = isAdmin ? "inline-block" : "none";
  adminDelBtn.style.display = isAdmin ? "inline-block" : "none";
});

loginBtn.onclick = () => {
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
};
logoutBtn.onclick = () => auth.signOut();

/* ================= CRUD ADMIN ================= */
postBtn.onclick = () => {
  if (!currentUser) return alert("Fa√ßa login");
  // Apenas o Admin pode postar, garantido pelo auth.onAuthStateChanged

  const name = prompt("Nome do jogo");
  const img  = prompt("URL da imagem (Capa)");
  const url  = prompt("Link do jogo (URL)");
  const desc = prompt("Descri√ß√£o curta");
  if (!name || !url) return;

  gamesRef.push({
    name,
    img: img || "https://via.placeholder.com/600x400/0f1025/ffffff?text=Game+Dev+Space",
    url,
    desc: desc || "Nenhuma descri√ß√£o fornecida.",
    owner: currentUser.uid,
    likes: 0,
    likedBy: {},
    views: 0,
    created: Date.now()
  });
};

// BOT√ÉO DE ADMIN: Excluir TODOS os jogos (CUIDADO!)
adminDelBtn.onclick = () => {
  if (confirm("üî¥ ATEN√á√ÉO: Confirma a EXCLUS√ÉO DE TODOS os JOGOS do banco de dados?")) {
    gamesRef.remove();
    alert("Todos os jogos foram apagados.");
  }
};


/* ================= RENDER ================= */
const gamesEl = document.getElementById("games");
const featuredEl = document.getElementById("featured");

function render() {
  // ATEN√á√ÉO: Se desejar remover todos os jogos existentes, DESCOMENTE a linha abaixo UMA √öNICA VEZ e depois comente novamente!
  // gamesRef.remove(); 
  
  gamesRef.on("value", snap => {
    gamesEl.innerHTML = "";
    featuredEl.innerHTML = "";

    const data = snap.val() || {};
    const list = Object.entries(data).map(([id, g]) => ({ id, ...g }));

    // Em destaque: 4 jogos com mais (curtidas + visualiza√ß√µes)
    list.sort((a, b) => (b.likes + b.views) - (a.likes + a.views))
        .slice(0, 4)
        .forEach(g => featuredEl.appendChild(createCard(g)));

    // Todos os jogos: ordenados por mais recentes
    list.sort((a, b) => b.created - a.created)
        .forEach(g => gamesEl.appendChild(createCard(g)));
  });
}
render();

/* ================= CARD ================= */
function createCard(g) {
  const card = document.createElement("div");
  card.className = "card";

  const canDelete = currentUser && (currentUser.uid === g.owner || currentUser.uid === OWNER_UID);
  const likes = g.likes || 0;

  card.innerHTML = `
    <div class="like-count">‚ù§ ${likes}</div>
    ${canDelete ? `<button class="delete-btn">X</button>` : ""}
    <img src="${g.img}" alt="${g.name} thumbnail">
    <div class="info">
      <h3>${g.name}</h3>
      <small>${g.desc}</small>
    </div>
  `;

  card.onclick = () => openGame(g);

  // Excluir Jogo Individual
  if (canDelete) {
    card.querySelector(".delete-btn").onclick = e => {
      e.stopPropagation();
      if (confirm(`Deletar o jogo "${g.name}"?`)) gamesRef.child(g.id).remove();
    };
  }

  return card;
}

/* ================= GAME PAGE ================= */
function openGame(g) {
  home.style.display = "none";
  gameView.style.display = "block";

  // Incrementa as visualiza√ß√µes
  gamesRef.child(g.id).child("views").transaction(v => (v || 0) + 1);

  // Verifica se o usu√°rio j√° curtiu
  const liked = currentUser && g.likedBy && g.likedBy[currentUser.uid];
  const likeButtonText = liked ? "‚≠ê Curtiu!" : "‚ù§ Curtir";

  gameView.innerHTML = `
    <button class="back-btn" onclick="back()">‚Üê Voltar</button>
    <div class="game-page">
      <img src="${g.img}" alt="${g.name} imagem">
      <h2>${g.name}</h2>
      <p>${g.desc}</p>
      <div class="game-actions">
        <button onclick="window.open('${g.url}')">‚ñ∂ Jogar Agora</button>
        <button id="likeBtn" onclick="like('${g.id}')">${likeButtonText}</button>
      </div>
    </div>
  `;
  
  // Atualiza o texto do bot√£o de curtir imediatamente se j√° curtiu
  const likeBtn = document.getElementById("likeBtn");
  if (liked) {
    likeBtn.disabled = true;
    likeBtn.style.background = 'var(--color-secondary)';
  }
}

function back() {
  gameView.style.display = "none";
  home.style.display = "block";
}

/* ================= LIKE (ANTI-SPAM APRIMORADO) ================= */
function like(id) {
  if (!currentUser) return alert("Fa√ßa login para curtir!");

  gamesRef.child(id).transaction(g => {
    if (!g) return g;
    g.likedBy = g.likedBy || {};

    // Se o usu√°rio J√Å curtiu, n√£o faz nada e retorna o objeto original
    if (g.likedBy[currentUser.uid]) return g; 

    // Se ainda N√ÉO curtiu:
    g.likedBy[currentUser.uid] = true; // Marca como curtido
    g.likes = (g.likes || 0) + 1; // Incrementa o contador
    
    // Atualiza o bot√£o na UI
    const likeBtn = document.getElementById("likeBtn");
    if (likeBtn) {
        likeBtn.textContent = "‚≠ê Curtiu!";
        likeBtn.disabled = true;
        likeBtn.style.background = 'var(--color-secondary)';
    }

    return g; // Retorna o objeto modificado para o Firebase
  });
}

// Fun√ß√µes de coment√°rios removidas
</script>
</body>
</html>
