<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Game Dev Space V2.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{margin:0;color:#fff;background:radial-gradient(circle at top,#1b1f3b,#050510 70%)}
header{padding:20px;position:sticky;top:0;background:rgba(10,10,25,.85);backdrop-filter:blur(12px);z-index:5}
header h1{margin:0;font-size:30px;font-weight:800;color:#22c55e}
.actions{position:absolute;right:20px;top:20px;display:flex;gap:10px;align-items:center}
button{background:#4f46e5;color:#fff;border:none;padding:10px 18px;border-radius:14px;font-weight:bold;cursor:pointer}
button.danger{background:#ef4444}
main{max-width:1200px;margin:auto;padding:30px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px}
.card{background:#0f1025;border-radius:18px;overflow:hidden;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,.4);position:relative;transition:.2s}
.card:hover{transform:translateY(-6px)}
.card img{width:100%;height:140px;object-fit:cover}
.info{padding:14px}
.like-count{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.6);padding:6px 12px;border-radius:999px}
#adminPanel{background:#0f1025;padding:20px;border-radius:18px;margin-bottom:30px;display:none}
#gameView{display:none;max-width:900px;margin:auto;padding:30px}
#loginModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:20;align-items:center;justify-content:center}
#loginBox{background:#0f1025;padding:30px;border-radius:18px;max-width:360px;width:90%;text-align:center}
footer{text-align:center;padding:30px;opacity:.4}
</style>
</head>
<body>

<header>
  <h1>Game Dev Space</h1>
  <div class="actions">
    <div id="userBadge" style="display:none;align-items:center;gap:8px;background:rgba(255,255,255,.08);padding:6px 12px;border-radius:999px">
      <img id="userPhoto" style="width:28px;height:28px;border-radius:50%">
      <small id="userName"></small>
    </div>
    <button id="loginBtn">Login</button>
    <button id="postBtn" style="display:none">Novo Jogo</button>
    <button id="logoutBtn" style="display:none">Sair</button>
  </div>
</header>

<div id="loginModal">
  <div id="loginBox">
    <h2>Entrar</h2>
    <p style="opacity:.7">Fa√ßa login para curtir e publicar jogos</p>
    <button id="googleLogin" style="width:100%">Entrar com Google</button>
    <br><br>
    <button onclick="closeLogin()" style="background:transparent">Cancelar</button>
  </div>
</div>

<main id="home">
  <section id="adminPanel">
    <h2>üëë Painel Admin</h2>
    <button id="toggleAdminDelete" class="danger">‚ùå MODO DELETAR: OFF</button><br><br>
    <button id="wipeGames" class="danger">üß® Apagar TODOS</button>
  </section>

  <h2>üî• Em alta da semana</h2>
  <div class="grid" id="weekly"></div>

  <h2 style="margin-top:40px">üéÆ Todos os jogos</h2>
  <div class="grid" id="games"></div>
</main>

<main id="gameView"></main>

<footer>Game Dev Space ‚Ä¢ plataforma indie</footer>

<script>
const OWNER_UID = "EvTgWu6fFFeWJrFdckMNVa1E20J3";
const firebaseConfig = {
  apiKey: "AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
  authDomain: "game-dev-space.firebaseapp.com",
  databaseURL: "https://game-dev-space-default-rtdb.firebaseio.com",
  projectId: "game-dev-space",
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const gamesRef = db.ref("games");

let currentUser=null;
let ADMIN_DELETE_MODE=false;

loginBtn.onclick=()=>loginModal.style.display="flex";
function closeLogin(){loginModal.style.display="none"}

googleLogin.onclick=()=>{
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(closeLogin);
};
logoutBtn.onclick=()=>auth.signOut();

auth.onAuthStateChanged(user=>{
  currentUser=user;
  const isAdmin=user&&user.uid===OWNER_UID;
  loginBtn.style.display=user?"none":"inline-block";
  logoutBtn.style.display=user?"inline-block":"none";
  postBtn.style.display=isAdmin?"inline-block":"none";
  adminPanel.style.display=isAdmin?"block":"none";

  if(user){
    userBadge.style.display="flex";
    userPhoto.src=user.photoURL;
    userName.textContent=user.displayName;
  }else userBadge.style.display="none";
});

postBtn.onclick=()=>{
  const name=prompt("Nome do jogo");
  const img=prompt("Imagem URL");
  const url=prompt("Link do jogo");
  if(!name||!url) return;
  gamesRef.push({name,img:img||"",url,likes:0,likedBy:{},owner:currentUser.uid,created:Date.now()});
};

wipeGames.onclick=()=>confirm("APAGAR TUDO?")&&gamesRef.remove();

toggleAdminDelete.onclick=()=>{
  ADMIN_DELETE_MODE=!ADMIN_DELETE_MODE;
  toggleAdminDelete.textContent=ADMIN_DELETE_MODE?"‚ùå MODO DELETAR: ON":"‚ùå MODO DELETAR: OFF";
};

const gamesEl=document.getElementById("games");
const weeklyEl=document.getElementById("weekly");

gamesRef.on("value",snap=>{
  gamesEl.innerHTML="";
  weeklyEl.innerHTML="";
  const data=snap.val()||{};
  const list=Object.entries(data).map(([id,g])=>({id,...g}));

  list.slice().sort((a,b)=>(b.likes||0)-(a.likes||0)).slice(0,4)
    .forEach(g=>weeklyEl.appendChild(card(g.id,g)));

  list.sort((a,b)=>b.created-a.created)
    .forEach(g=>gamesEl.appendChild(card(g.id,g)));
});

function card(id,g){
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`<div class='like-count'>‚ù§ ${g.likes||0}</div><img src='${g.img}'><div class='info'><h3>${g.name}</h3></div>`;
  d.onclick=()=>{
    if(currentUser&&currentUser.uid===OWNER_UID&&ADMIN_DELETE_MODE){
      confirm(`DELETAR ${g.name}?`)&&gamesRef.child(id).remove();
    }else openGame(id,g);
  };
  return d;
}

function openGame(id,g){
  home.style.display="none";
  gameView.style.display="block";
  gameView.innerHTML=`<button onclick='back()'>‚Üê Voltar</button><h2>${g.name}</h2><button onclick="like('${id}')">‚ù§ Curtir</button><button onclick="window.open('${g.url}')">Jogar</button>`;
}
function back(){gameView.style.display="none";home.style.display="block"}

function like(id){
  if(!currentUser) return alert("Fa√ßa login");
  gamesRef.child(id).transaction(g=>{
    if(!g) return g;
    g.likedBy=g.likedBy||{};
    if(g.likedBy[currentUser.uid]) return g;
    g.likedBy[currentUser.uid]=true;
    g.likes=(g.likes||0)+1;
    return g;
  });
}
</script>
</body>
</html>
