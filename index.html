<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oficina do Noel - Games</title>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Quicksand:wght@500&display=swap" rel="stylesheet">
    <style>
        :root { --red: #d42426; --green: #165b33; --gold: #f8b229; --white: #f8f9fa; --sky: #a5d8ff; }

        body {
            margin: 0; background: #0a1f14; color: var(--white);
            font-family: 'Quicksand', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; overflow: hidden;
        }

        h1 { font-family: 'Mountains of Christmas', cursive; font-size: 3rem; color: var(--red); text-shadow: 2px 2px 0px white; margin: 10px 0; }

        /* Console */
        .game-machine {
            background: var(--green); padding: 15px; border-radius: 30px;
            border: 8px solid var(--red); box-shadow: 0 15px 30px rgba(0,0,0,0.5);
            width: 90vw; max-width: 450px; z-index: 10;
        }

        .screen {
            background: var(--sky); border-radius: 15px; height: 400px;
            position: relative; overflow: hidden; border: 4px solid #333;
        }

        /* Menu */
        .menu { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; gap: 12px; background: #e0f4ff; }
        .btn-game {
            background: var(--red); color: white; border: none; padding: 12px 20px;
            font-family: 'Mountains of Christmas', cursive; font-size: 1.4rem;
            border-radius: 50px; cursor: pointer; width: 80%; transition: 0.2s;
            box-shadow: 0 4px 0 #8b1a1a;
        }
        .btn-game:hover { transform: scale(1.05); background: #ff3e3e; }

        /* Elementos Jogo */
        #player { position: absolute; width: 50px; height: 40px; z-index: 10; pointer-events: none; }
        .pipe { position: absolute; background: #5d4037; width: 50px; border: 3px solid #3e2723; border-radius: 5px; }
        .falling-item { position: absolute; width: 35px; height: 35px; }
        .score-board { position: absolute; top: 10px; left: 10px; color: #333; font-weight: bold; font-size: 1.2rem; z-index: 20; }
        .back-btn { position: absolute; top: 10px; right: 10px; background: var(--red); border: none; color: white; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; z-index: 30; font-weight: bold; }

        canvas.snow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
    </style>
</head>
<body>

    <canvas class="snow" id="snowCanvas"></canvas>

    <h1>Oficina Fechada</h1>

    <div class="game-machine">
        <div class="screen" id="screen">
            <div class="menu" id="mainMenu">
                <h2 style="color: var(--green); margin: 0 0 10px 0;">Biblioteca do Noel</h2>
                <button class="btn-game" onclick="startGame('flappy')">üöÄ Voo do Noel (Flappy)</button>
                <button class="btn-game" onclick="startGame('collect')">üéÅ Pegar Presentes</button>
                <button class="btn-game" onclick="startGame('dodge')">ü™® Desviar do Carv√£o</button>
            </div>
        </div>
    </div>

    <script>
        const screen = document.getElementById('screen');
        const mainMenu = document.getElementById('mainMenu');
        let gameActive = false, score = 0, gravity = 0.4, velocity = 0, playerY = 150;
        let obstacles = [], gameLoopIdx;

        const svgSleigh = `<svg viewBox="0 0 512 512" fill="#d42426"><path d="M496 384c-8.8 0-16 7.2-16 16s7.2 16 16 16 16-7.2 16-16-7.2-16-16-16zm-48 32c-8.8 0-16 7.2-16 16s7.2 16 16 16 16-7.2 16-16-7.2-16-16-16zM16 352h400c8.8 0 16-7.2 16-16s-7.2-16-16-16H278.1c-14.7-29.3-44.8-48-78.1-48s-63.4 18.7-78.1 48H16c-8.8 0-16 7.2-16 16s7.2 16 16 16z"/></svg>`;
        const svgGift = `<svg viewBox="0 0 512 512"><rect x="128" y="128" width="256" height="256" rx="20" fill="#165b33"/><path d="M256 128v256M128 256h256" stroke="#f8b229" stroke-width="20"/></svg>`;
        const svgCoal = `<svg viewBox="0 0 512 512" fill="#333"><circle cx="256" cy="256" r="200"/></svg>`;

        function startGame(type) {
            gameActive = true; score = 0; obstacles = []; velocity = 0; playerY = 150;
            mainMenu.style.display = 'none';
            screen.innerHTML = `<button class="back-btn" onclick="resetMenu()">X</button><div class="score-board">Pontos: 0</div><div id="player" style="left:50px; top:150px;">${svgSleigh}</div>`;
            
            const player = document.getElementById('player');
            const sb = screen.querySelector('.score-board');

            if(type === 'flappy') {
                screen.onclick = () => velocity = -6;
                gameLoopIdx = setInterval(() => updateFlappy(player, sb), 20);
                setInterval(() => { if(gameActive) createPipe(); }, 2000);
            } else {
                screen.onmousemove = (e) => {
                    let x = e.clientX - screen.getBoundingClientRect().left - 25;
                    player.style.left = Math.max(0, Math.min(x, screen.offsetWidth - 50)) + 'px';
                    player.style.bottom = "10px"; player.style.top = "auto";
                };
                gameLoopIdx = setInterval(() => createFalling(type, player, sb), 800);
            }
        }

        function updateFlappy(player, sb) {
            velocity += gravity;
            playerY += velocity;
            player.style.top = playerY + 'px';
            player.style.transform = `rotate(${velocity * 3}deg)`;

            if(playerY < 0 || playerY > 360) gameOver();

            obstacles.forEach((obs, idx) => {
                let x = parseInt(obs.style.left) - 3;
                obs.style.left = x + 'px';
                
                let pRect = player.getBoundingClientRect(), oRect = obs.getBoundingClientRect();
                if(pRect.right > oRect.left && pRect.left < oRect.right && pRect.bottom > oRect.top && pRect.top < oRect.bottom) gameOver();
                if(x < -60) { obs.remove(); obstacles.splice(idx, 1); if(idx % 2 === 0) { score++; sb.innerText = `Pontos: ${score}`; } }
            });
        }

        function createPipe() {
            let gap = 120, minH = 50, maxH = 200;
            let topH = Math.floor(Math.random() * (maxH - minH + 1)) + minH;
            let p1 = document.createElement('div'); p1.className = 'pipe'; p1.style.height = topH + 'px'; p1.style.top = '0'; p1.style.left = '450px';
            let p2 = document.createElement('div'); p2.className = 'pipe'; p2.style.height = (400 - topH - gap) + 'px'; p2.style.bottom = '0'; p2.style.left = '450px';
            screen.appendChild(p1); screen.appendChild(p2);
            obstacles.push(p1, p2);
        }

        function createFalling(type, player, sb) {
            if(!gameActive) return;
            const item = document.createElement('div');
            item.className = 'falling-item';
            item.innerHTML = type === 'collect' ? svgGift : svgCoal;
            item.style.left = Math.random() * 370 + 'px'; item.style.top = '-40px';
            screen.appendChild(item);
            let fall = setInterval(() => {
                let t = parseFloat(item.style.top) + 4; item.style.top = t + 'px';
                let pR = player.getBoundingClientRect(), iR = item.getBoundingClientRect();
                if(iR.bottom > pR.top && iR.left < pR.right && iR.right > pR.left) {
                    if(type === 'collect') { score++; sb.innerText = `Pontos: ${score}`; } else gameOver();
                    clearInterval(fall); item.remove();
                }
                if(t > 400) { clearInterval(fall); item.remove(); if(type === 'dodge') { score++; sb.innerText = `Pontos: ${score}`; } }
            }, 20);
        }

        function gameOver() { gameActive = false; clearInterval(gameLoopIdx); alert("Fim de Jogo! Pontos: " + score); resetMenu(); }
        function resetMenu() { gameActive = false; clearInterval(gameLoopIdx); screen.innerHTML = ''; screen.appendChild(mainMenu); mainMenu.style.display = 'flex'; }

        // Neve Canvas
        const canvas = document.getElementById('snowCanvas'), ctx = canvas.getContext('2d');
        let parts = [];
        function res() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = res; res();
        for(let i=0; i<80; i++) parts.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*3+1, d: Math.random()+0.5});
        function draw() {
            ctx.clearRect(0,0,canvas.width, canvas.height); ctx.fillStyle = "white"; ctx.beginPath();
            parts.forEach(p => { ctx.moveTo(p.x, p.y); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); p.y += p.d; if(p.y > canvas.height) p.y = -10; });
            ctx.fill(); requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>
