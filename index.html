<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Game Dev Space</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }
    body { margin: 0; background:#0f0f14; color:#fff; }

    header {
      padding:20px;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#151522;
      position:relative;
    }

    header h1 { margin:0; font-size:28px; }

    header .actions {
      position:absolute;
      right:20px;
      display:flex;
      gap:10px;
    }

    header button {
      background:#4f46e5;
      color:#fff;
      border:none;
      padding:8px 14px;
      border-radius:10px;
      font-weight:bold;
      cursor:pointer;
    }

    main { max-width:1200px; margin:auto; padding:20px; }

    .form {
      background:#151522;
      padding:20px;
      border-radius:14px;
      margin-bottom:30px;
      display:none;
      gap:12px;
    }

    .form input, .form button {
      padding:10px;
      border-radius:8px;
      border:none;
      outline:none;
      width:100%;
    }

    .form input { background:#0f0f14; color:#fff; }

    .form button {
      background:#22c55e;
      color:#000;
      font-weight:bold;
      cursor:pointer;
    }

    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
      gap:20px;
    }

    .card {
      background:#151522;
      border-radius:16px;
      overflow:hidden;
      transition:.2s;
      position:relative;
    }

    .card:hover { transform:scale(1.04); }

    .card img {
      width:100%;
      height:140px;
      object-fit:cover;
      background:#000;
    }

    .info { padding:14px; }
    .info h3 { margin:0 0 8px; font-size:18px; }
    .info a {
      color:#4f46e5;
      text-decoration:none;
      font-size:14px;
      font-weight:bold;
    }

    .owner-actions {
      position:absolute;
      top:8px;
      right:8px;
      display:flex;
      gap:6px;
    }

    .owner-actions button {
      font-size:12px;
      padding:4px 6px;
      border-radius:6px;
      border:none;
      cursor:pointer;
    }

    .edit { background:#facc15; }
    .delete { background:#ef4444; color:#fff; }

    footer {
      text-align:center;
      padding:20px;
      opacity:.4;
    }
  </style>
</head>
<body>

<header>
  <h1>Game Dev Space</h1>
  <div class="actions">
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" style="display:none">Sair</button>
    <button id="postBtn" style="display:none">Postar</button>
  </div>
</header>

<main>

  <div class="form" id="form">
    <input id="name" placeholder="Nome do jogo" />
    <input id="url" placeholder="Link do jogo (HTML)" />
    <input id="img" placeholder="Link da thumbnail" />
    <button id="publishBtn">Publicar</button>
  </div>

  <div class="grid" id="games"></div>

</main>

<footer>
  Game Dev Space â€¢ Biblioteca aberta para jogos HTML
</footer>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAMHAKVot044psR421B_t-Ht5EmsueVS8A",
    authDomain: "game-dev-space.firebaseapp.com",
    databaseURL: "https://game-dev-space-default-rtdb.firebaseio.com",
    projectId: "game-dev-space",
    storageBucket: "game-dev-space.firebasestorage.app",
    messagingSenderId: "1073185335190",
    appId: "1:1073185335190:web:ae9ffd88cdf89f53cbdfb7"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const database = firebase.database();
  const gamesRef = database.ref('games');

  const grid = document.getElementById('games');
  const form = document.getElementById('form');
  const postBtn = document.getElementById('postBtn');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const publishBtn = document.getElementById('publishBtn');

  let currentUser = null;

  function toggleForm() {
    form.style.display = form.style.display === 'grid' ? 'none' : 'grid';
  }

  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  };

  logoutBtn.onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    currentUser = user;
    if (user) {
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
      postBtn.style.display = 'inline-block';
    } else {
      loginBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
      postBtn.style.display = 'none';
      form.style.display = 'none';
    }
    renderGames();
  });

  postBtn.onclick = toggleForm;

  publishBtn.onclick = () => {
    const name = document.getElementById('name').value.trim();
    const url = document.getElementById('url').value.trim();
    const img = document.getElementById('img').value.trim();

    if (!name || !url) return alert('Preencha nome e link');

    gamesRef.push({
      name,
      url,
      img,
      owner: currentUser.uid,
      ownerName: currentUser.displayName,
      createdAt: Date.now()
    });

    form.style.display = 'none';
    document.getElementById('name').value = '';
    document.getElementById('url').value = '';
    document.getElementById('img').value = '';
  };

  function renderGames() {
    gamesRef.on('value', snap => {
      grid.innerHTML = '';
      const data = snap.val();
      if (!data) return;

      Object.entries(data)
        .sort((a,b) => b[1].createdAt - a[1].createdAt)
        .forEach(([id, g]) => {
          const card = document.createElement('div');
          card.className = 'card';

          let ownerButtons = '';
          if (currentUser && g.owner === currentUser.uid) {
            ownerButtons = `
              <div class="owner-actions">
                <button class="delete" onclick="deleteGame('${id}')">X</button>
              </div>`;
          }

          card.innerHTML = `
            ${ownerButtons}
            <img src="${g.img || 'https://via.placeholder.com/400x200'}">
            <div class="info">
              <h3>${g.name}</h3>
              <a href="${g.url}" target="_blank">Jogar</a>
            </div>`;

          grid.appendChild(card);
        });
    });
  }

  window.deleteGame = id => {
    if (!confirm('Deletar este jogo?')) return;
    gamesRef.child(id).remove();
  };
</script>

</body>
</html>
